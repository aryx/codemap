#!/bin/sh
set -eu # to debug this script add '-x'

###############################################################################
# Prelude
###############################################################################
# The goal of this script is to automate the configuration and installation
# of packages that are needed to then compile and install codemap itself.
# See also my https://github.com/aryx/xix/blob/master/configure for more info.

###############################################################################
# Platform specific setup
###############################################################################

#TODO?
#if [[ -e /etc/alpine-release ]]; then
#    # TODO: at some point we should move the content of this target here
#    make install-deps-ALPINE
#else
#    OS=`uname`
#    echo "Only Alpine is supported. OS $OS is not yet supported:"
#    exit 2
#fi

# TODO: on macOS double check pkg-conf is installed

###############################################################################
# Platform independent
###############################################################################

#TODO:
# - check opam is in PATH
# - check opam was initialized
# - use opam.locked

#in theory we should also
# - check the ocaml switch is a good version
# - check external deps are installed (e.g., pcre)

opam install --no-depexts --deps-only ./codemap.opam -y

echo 'Everything looks fine. You can now run: '
echo
echo '   $ make'
echo '   $ make all'
echo '   $ make install'
